<html><head></head><body><div hidden=""><dom-module id="nap-live"><style> #nap-live{ text-align: center; max-width:950px; width:950px; margin:0 auto; } #nap-live .heading { display: block; margin: 25px auto 10px; max-width: 100%; } #nap-live .sub-title{ line-height: 32px; color: #333; } #nap-live .user-sessions { display: inline-block; border-bottom: 1px solid #666; text-transform: uppercase; color: #666; padding-bottom: 5px; } #nap-live .user-sessions span { font-size: 13px; letter-spacing: 2px; } #nap-live .sell{ font-family: ModernNAP-Display; margin: 15px 0 25px; font-size: 17px; font-style: italic; } @media only screen and (max-width: 480px) { .sell{ font-family: GillSans, "Gill Sans MT", Calibri, sans-serif; padding:0 20px; } } #nap-live { overflow: hidden; height:480px; } </style><template><div id="nap-live"><img class="heading" src="//www.net-a-porter.com/alfresco/nap/webAssets/webPage/homepage-rebuild/components/images/logo.png"><div class="user-sessions"><nap-live-sessions></nap-live-sessions><span>{{_translate(copy, 'shoppers_online')}}</span></div><div class="sell">{{_translate(copy, 'what_women_buying')}}</div><nap-live-products></nap-live-products></div></template><script>Polymer({is:"nap-live",properties:{copy:{type:Object,value:{en:{shoppers_online:"Shoppers online",what_women_buying:"Showcasing what the world's most stylish women are buying right now"},de:{shoppers_online:"Shoppers online",what_women_buying:"Was die stylishsten Frauen der Welt jetzt kaufen"},fr:{shoppers_online:"visiteurs en ligne",what_women_buying:"Ce que les femmes les plus élégantes au monde achètent à cet instant"},zh:{shoppers_online:"位时尚爱好者在线",what_women_buying:"同步了解全球时尚女性正在购买的抢手单品"}}}},_translate:function(copy,key){return copy[NAP.locale.language][key]}});</script></dom-module><dom-module id="nap-live-sessions"><style> .user-count { display: inline; } .user-count span { font-size: 13px; letter-spacing: 2px; } #session-count { padding-right: 5px } </style><template><iron-ajax id="getSessions" auto="" url="/webapi/feed/sessioncount/NAP.json" handle-as="json" last-response="{{sessionsApiResponse}}" last-error="{{sessionsApiError}}" on-request="_onRequest" on-response="_onResponse" on-error="_onError"></iron-ajax><div class="user-count"><span id="session-count">{{userSessions}}</span></div></template><script>var errorTimerMultipler=1;var errorRefreshTimerMaximum=3e5;var refreshSessionsTimer=6e4;Polymer({is:"nap-live-sessions",properties:{userSessions:{type:Number,value:0}},_onRequest:function(){NAP.monitoring.registerPerfMark(this.$.getSessions.url)},_onResponse:function(){if(this.sessionsApiResponse&&this.sessionsApiResponse.sessioncount){this.userSessions=this.sessionsApiResponse.sessioncount;this.async(function(){this.$.getSessions.generateRequest();errorTimerMultipler=1},refreshSessionsTimer);NAP.monitoring.measurePerfMark("Polymer",this.$.getSessions.url,{status:"success"})}else{this._onError()}},_onError:function(){var errorTimerMultiplied=refreshSessionsTimer*errorTimerMultipler;var errorThrown;this.userSessions=this.userSessions>0?this.userSessions:31337;this.async(function(){this.$.getSessions.generateRequest()},errorTimerMultiplied);if(errorTimerMultiplied<errorRefreshTimerMaximum){errorTimerMultipler=errorTimerMultipler*2}if(this.sessionsApiError){errorThrown=this.sessionsApiError.error.message}else{errorThrown="sessions response empty"}NAP.monitoring.registerPerfMetricAndMonitoring("Polymer","API Failure",this.$.getSessions.url,{url:this.$.getSessions.url,status:"error",errorThrown:errorThrown})}});</script></dom-module><dom-module id="nap-live-product-activity"><style> .activity{ font-family: ModernNAP-Display; color:#333; margin: 5px 0; font-style: italic; } .locale span{ font-size:12px; white-space: nowrap; display: inline-block; } .city{ border-right: 1px solid #cbcbcb; margin-right: 3px; padding-right: 6px; } </style><template><div class="activity">{{_translate(copy, activity.type)}}</div><div class="locale"><template is="dom-if" if="{{activity.locale.city}}"><span class="city">{{activity.locale.city}}</span></template><span class="country">{{activity.locale.country}}</span></div></template><script>Polymer({is:"nap-live-product-activity",properties:{activity:Object,copy:{type:Object,value:{en:{tell_a_friend:"Tell a friend",share:"Shared",add_to_wishlist:"Added to wishlist",add_to_basket:"Added to basket"},de:{tell_a_friend:"Weiterempfehlen",share:"Teilen",add_to_wishlist:"Zur Wunschliste hinzugefügt",add_to_basket:"Zum Warenkorb hinzugefügt"},fr:{tell_a_friend:"Voir les détails",share:"Partager",add_to_wishlist:"Ajouté à ma wish list",add_to_basket:"Ajouté au panier"},zh:{tell_a_friend:"与好友分享",share:"分享",add_to_wishlist:"已加入愿望清单",add_to_basket:"已加入购物袋"}}}},_translate:function(copy,key){return copy[NAP.locale.language][key.toLowerCase()]}});</script></dom-module><dom-module id="nap-live-products"><style> :host { overflow:hidden; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; -o-user-select: none; user-select: none; } .row { -webkit-flex-wrap: inherit; -ms-flex-wrap: inherit; flex-wrap: inherit; margin-right: 0; margin-left: 0; } .swiper-prev, .swiper-next { display: block; position: absolute; z-index: 2; top: calc(50% - 25px); cursor: pointer; } .swiper-next { right: 0; } .swiper-button-disabled { display: none; } .swiper-container { position: relative; } nap-product ::shadow{ margin-bottom: 0; position: relative; text-align: center; } nap-product ::shadow .name{ font-family: ModernNAP-Display; text-transform: uppercase; } nap-product ::shadow .designer { overflow: hidden; text-overflow: ellipsis; display: -webkit-box; line-height: 18px; height: 36px; -webkit-line-clamp: 2; -webkit-box-orient: vertical; } @media only screen and (max-width: 480px) { nap-live-product-activity ::shadow .nap-live-product-activity { font-family: GillSans, "Gill Sans MT", Calibri, sans-serif; } } </style><template><iron-ajax id="getProduct" auto="" url="/webapi/feed/productactivity.json" params="{{_generateParams(size)}}" handle-as="json" last-response="{{productActivityApiResponse}}" last-error="{{productActivityApiError}}" on-request="_onRequest" on-response="_onResponse" on-error="_onError"></iron-ajax><div id="naplive-carousel" class="swiper-container"><div class="icon icon-arrow_left swiper-prev"></div><div class="swiper-wrapper row"><template is="dom-repeat" items="{{uniqueProductsArr}}"><div class="col-xs-6 col-sm-4 col-lg-2 swiper-slide"><nap-product product$="{{item}}" itemprop$="{{schemaproperty}}"></nap-product><nap-live-product-activity activity$="{{item.activity}}"></nap-live-product-activity></div></template></div><div class="icon icon-arrow_right swiper-next"></div></div></template><script>var errorTimerMultipler=1;var errorRefreshTimerMaximum=6e4;var refreshProductsTimer=3e3;Polymer({is:"nap-live-products",properties:{size:{type:Number,value:6},uniqueProductsArr:{type:Array,value:[]},carousel:{type:Boolean,value:false},carouselInstance:Object},_callAPI:function(){this.$.getProduct.generateRequest();errorTimerMultipler=1},_generateParams:function(size){return{channel:"NAP_"+NAP.locale.channel.toUpperCase(),size:size}},_onRequest:function(){NAP.monitoring.registerPerfMark(this.$.getProduct.url)},_onResponse:function(){if(this.productActivityApiResponse&&this.productActivityApiResponse.productactivity){this._updateProducts(this.productActivityApiResponse);this.async(this._callAPI,refreshProductsTimer);NAP.monitoring.measurePerfMark("Polymer",this.$.getProduct.url,{status:"success"});this._initCarousel()}else{this._onError()}},_onError:function(){var errorTimerMultiplied=refreshProductsTimer*errorTimerMultipler;var errorThrown;this.async(function(){this.$.getProduct.generateRequest()},errorTimerMultiplied);if(errorTimerMultiplied<errorRefreshTimerMaximum){errorTimerMultipler=errorTimerMultipler*2}if(this.productActivityApiError){errorThrown=this.productActivityApiError.error.message}else{errorThrown="product response empty"}NAP.monitoring.registerPerfMetricAndMonitoring("Polymer","API Failure",this.$.getProduct.url,{url:this.$.getProduct.url,status:"error",errorThrown:errorThrown})},_updateProducts:function(productActivityArr){var normalisedProductDataArr=this._normaliseProductData(productActivityArr);this._updateProductBuffer(normalisedProductDataArr)},_normaliseProductData:function(productActivityArr){var normalisedProductDataArr=[];productActivityArr.productactivity.forEach(function(productObj){normalisedProductDataArr.push({id:productObj.pid,brand:{name:productObj.designer},name:productObj.title,nameInvisible:true,feature:"NAP LIVE",activity:{hash:productObj.hash,activityCreated:productObj.activityCreated,type:productObj.activityType.toLowerCase(),locale:{city:productObj.city,country:productObj.country,latitude:productObj.latitude,longitude:productObj.longitude}}})});return normalisedProductDataArr},_updateProductBuffer:function(normalisedProductDataArr){var that=this;normalisedProductDataArr.forEach(function(normalisedProductObj){that._checkIfHashHasBeenUsedBefore(normalisedProductObj)})},_checkIfHashHasBeenUsedBefore:function(normalisedProductObj){var uniqueProductsArr=this.uniqueProductsArr;if(uniqueProductsArr.length>0){var hashAlreadyExists=false;uniqueProductsArr.forEach(function(uniqueProductObj){if(uniqueProductObj.activity.hash===normalisedProductObj.activity.hash){hashAlreadyExists=true}});if(!hashAlreadyExists){this._addUniqueProductsToArr(normalisedProductObj)}}else{this._addUniqueProductsToArr(normalisedProductObj)}},_addUniqueProductsToArr:function(normalisedProductObj){this.push("uniqueProductsArr",normalisedProductObj)},_initCarousel:function(){if(!this.carouselInstance){this.carouselInstance=new Swiper(this.$$("#naplive-carousel"),{nextButton:this.$$(".swiper-next"),prevButton:this.$$(".swiper-prev"),slidesPerView:6,simulateTouch:false,autoplay:4e3});if(this.carouselInstance.slides.length>8){this.carouselInstance.startAutoplay()}else{this.carouselInstance.stopAutoplay()}}else{this.carouselInstance.update();if(this.carouselInstance.slides.length>8&&!this.carouselInstance.autoplaying){this.carouselInstance.startAutoplay()}}},attached:function(){if(this.carousel&&this.pids.length>6){var orientation;var self=this;window.addEventListener("resize",function(){self._initCarousel()});window.addEventListener("deviceorientation",function(){switch(true){case NAP.device.portrait()&&orientation==="landscape":orientation="portrait";self._initCarousel();break;case NAP.device.landscape()&&orientation==="portrait":orientation="landscape";self._initCarousel();break}})}}});</script></dom-module></div></body></html>